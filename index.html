<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Signal</title>
</head>
<style>
    body {
        overflow: hidden;
        margin: 0;
    }

    #Player {
        position: absolute;
        background: url("PlayerScope.png") no-repeat center;
        background-size: contain;
        width: 100px;
        height: 100px;
    }

    .enemy {
        position: absolute;
        background: chocolate;
        width: 20px;
        height: 20px;
        transition: top 5s linear;
        top: 0;
    }

    .plane {
        position: absolute;
        background: gray;
        width: 50px;
        height: 50px;
        transition: left 1.5s linear;
        left: 100%;
    }

    .payload {
        width: 40px;
        height: 40px;
        position: absolute;
        background: red;
    }

    #line {
        height: 2px;
        background: red;
        position: absolute;
        user-select: none;
        color: transparent;
    }

    .marker {
        position: absolute;
        top: -20px;
        font-size: 12px;
        color: black;
    }

</style>
<body>
    <p><span id="LocationX">123</span> , <span id="LocationY">123</span></p>
    <div id="Player"></div>
    <div id="line">123</div>
    <hr id="PlayerBase" style="position: absolute; bottom: 0; width: 100%; border-color: blue;">
</body>
<script>
    const Player = document.getElementById("Player");
    const LocationX = document.getElementById("LocationX");
    const LocationY = document.getElementById("LocationY");
    const line = document.getElementById('line');

    document.addEventListener("mousemove", (e) => {
        temp = e.clientY - Player.offsetHeight / 2 + 'px';
        Player.style.top = temp;
        LocationY.textContent = parseInt(temp) + Player.offsetHeight / 2;
        temp = e.clientX - Player.offsetWidth / 2 + 'px';
        Player.style.left = temp;
        LocationX.textContent = parseInt(temp) + Player.offsetWidth / 2;
        line.style.width = window.screen.width - e.clientX + 'px';
        line.style.left = e.clientX - Player.offsetWidth / 100 + 'px';
        line.style.top = e.clientY - Player.offsetHeight / 100 + 'px';
        line.textContent = (1.5 / (window.screen.width / (window.screen.width - e.clientX))).toFixed(2) + ' sec';
        for (let x = 0; x <= window.screen.width; x+= 100) {
            const label = document.createElement('span');
            label.classList.add('marker');
            label.style.left = `${x}px`;
            label.textContent = (1.5 / (window.screen.width / (window.screen.width - e.clientX - x))).toFixed(2) + ' sec';
            line.appendChild(label);
        }
    });

    /*
    window.addEventListener('keydown', function(e) {
        if ('a' === e.key.toLowerCase()) {
            Player.style.left = Player.offsetLeft - 11 + 'px';
            LocationX.textContent = Player.offsetLeft;
        } else if ('d' === e.key.toLowerCase()) {
            Player.style.left = Player.offsetLeft + 11 + 'px';
            LocationX.textContent = Player.offsetLeft;
        } else if ('w' === e.key.toLowerCase()) {
            Player.style.top = Player.offsetTop - 11 + 'px';
            LocationY.textContent = Player.offsetTop;
        } else if ('s' === e.key.toLowerCase()) {
            Player.style.top = Player.offsetTop + 11 + 'px';
            LocationY.textContent = Player.offsetTop;
        }
    })
        */

    function SpawnEnemy() {
        const enemy = document.createElement('div');
        enemy.classList.add('enemy');
        enemy.style.left = Math.random() * 100 + '%';
        document.body.appendChild(enemy);
        setTimeout(() => enemy.style.top = '100%', 1);
        setTimeout(() => {
            enemy.remove(); 
        }, 5000);

        const enemyline = document.createElement('div');
        enemyline.classList.add('enemyline');
        enemyline.style.left = enemy.offsetLeft;
        document.body.appendChild(enemyline);

        /*
        for (let x = 0; x <= window.screen.width; x+= 100) {
            const label = document.createElement('span');
            label.classList.add('marker');
            label.style.top = `${x}px`;
            label.textContent = (1.5 / (window.screen.height / (window.screen.height - enemy.style.top - x))).toFixed(2) + ' sec';
            enemyline.appendChild(label);
        }
            */
    }

    let x = 1000;
    function WaitToSpawnEnemy() {
        SpawnEnemy();
        x--;
        setTimeout(() => {
            WaitToSpawnEnemy();
        }, x);       
    }
    WaitToSpawnEnemy();

    document.addEventListener("mousedown", (e) => {
        const plane = document.createElement('div');
        plane.classList.add('plane');
        plane.style.top = e.clientY - Player.offsetHeight / 4 + 'px';
        document.body.appendChild(plane);
        setTimeout(() => plane.style.left = '-50px', 1);
        setTimeout(() => {
            console.log("Flew to");
            const payload = document.createElement('div');
            payload.classList.add('payload');
            console.log(e.clientX);
            document.body.appendChild(payload);

            // If you want this to by dynamic (Player.offsetWidth / payload.offsetWidth * 2) and not 5
            payload.style.left = e.clientX - Player.offsetWidth / 5 + 'px';
            payload.style.top = e.clientY - Player.offsetHeight / 5 + 'px';
            setTimeout(() => {
                payload.classList.add('destruction');
                payload.style.background = "yellow";
            }, 300);
            setTimeout(() => {
                payload.remove();
            }, 2000);
        }, 1500 / (window.screen.width / (window.screen.width - e.clientX)));
        setTimeout(() => {
            plane.remove();
        }, 3100);
    })

    const PlayerBase = document.getElementById("PlayerBase");
    function CheckCollision() {
        const payloads = document.querySelectorAll('.destruction');
        const enemies = document.querySelectorAll('.enemy');

        payloads.forEach(payload => {
            enemies.forEach(enemy => {
                if (isColliding(enemy, payload)) {
                    enemy.remove();
                }
            });
        });

        enemies.forEach(enemy => {
            if (isColliding(enemy, PlayerBase)) {
                console.log("ENEMY WENT OVER");
                enemy.remove();
            }
        });

        requestAnimationFrame(CheckCollision);
    }

    function isColliding(e1, e2) {
        const rect1 = e1.getBoundingClientRect();
        const rect2 = e2.getBoundingClientRect();

        return !(
            rect1.top > rect2.bottom || 
            rect1.bottom < rect2.top || 
            rect1.left > rect2.right || 
            rect1.right < rect2.left
        );
    }

    CheckCollision();
</script>
</html>